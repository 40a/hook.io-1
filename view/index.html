<!-- 
    this entire file is sloppy. 
    please open up a pull request at https://github.com/bigcompany/hook.io to clean it up
    source @ https://github.com/bigcompany/hook.io/blob/master/view/index.html 
-->
<style>
  .userBar {
    font-size: 26px;
    padding-bottom: 40px;
    text-align: left;
    float: left;
    padding-left: 100px;
  }

  .tagLines li {
    font-size:22px;
    text-align: left;
    margin-left: 5px;
    list-style-image: url('/img/little-sideways-pipe-grey.gif');
  }

/*  
  .splashImage {
    padding-top: 10px;
    margin-top: 2px;
    margin-left: 16px;
  }
*/
  iframe {
    padding: 0px;
    margin: 0px;
  }
  .gatewayForm {
    padding: 0px;
    margin: 0px;
  }

  .saveForm {
    padding: 0px;
    margin: 0px;
    float: right;
    position: relative;
    left: 5px;
  }
  
  .gist {
    width: 500px;
  }
  
  .btn-group {
    box-shadow: 10px 10px 5px #888888;
    margin-bottom: 10px;
  }
  
  .btn-default:hover {
    background-color: #CCEEF9;
  }

  .hookFrame {
    margin-top: 10px;
    margin-bottom: 10px;
    font-family: monospace;
    height: 210px;
    color: black;
    border: solid;
    border-width: 1px;
    box-shadow: 10px 10px 5px #888888;
    display: none;
    padding: 10px;
    width: 100%;
  }
  .codeButton {
   /* display: none; */
  }
  div.line {
    height: 16px;
    margin-top: 0.39px;
  }

  .gist-file div {
/*    line-height: 0.7em; */
  }
  .splashImage img {
    /*
    height: 60px;
    width: 115px;
    */
    padding-left: 10px;
    padding-right: 10px;
    cursor: pointer;
    margin: 8px;
  }
  .features {
    list-style-type: disc;
    padding-left: 15px;
    font-size: 16px;
  }
  .splashSections > div {
    /* width: 565px; */
    font-size: 22px;
    text-align: left;
  }

  .examples {
    /* width: 580px; */
    /* text-align: center; */
  }
  .loginBar {
   /* padding-top:10px; */
  }
  .loginBar .curls input {
    margin-bottom:5px;
  }

  .curls input {
    width: 368px;
  }

  .lowerNav td {
    width: 200px;
  }
  
  .lowerNav {
    width: 100%;
    margin: 10px;
    padding: 10px;
  }
  
  .welcome {
    font-size: 36px;
  }

  .splash .hookStats {
    font-size: 32px;
  }

  .splash code, pre {
    padding: 5px;
    margin: 5px;
    width: 500px;
  }
  .splash ul {
    list-style-type: disc;
  }
  .deploymentsLink {
    color: black;
    font-size: 32px;
  }
  .totalRun {
    font-style: italic;
    font-size: 32px;
    
  }
  
  button {
    font-size: 22px;
  }
  
  .loadingImg  {
    display: none;
    height: 48px;
    width: 48px;
  }
  
  .callToAction {
    font-size: 20px;
  }
  
  .selectSnippet {
    height: 39px;
    margin: 0px;
    padding: 0px;  
  }
  
  .prevSnippet {
    /* display: none; */
  }
  
  .transport .octicon {
    font-size: 28px;
  }

  .transport {
    color: black;
    border: solid;
    border-width: 1px;
    box-shadow: 10px 10px 5px #888888;
    padding-left: 10px;
    padding-right: 5px;
    padding-top: 10px;
    width: 100%;
  }
  .transportControl {
    padding-bottom: 10px;
    margin-right: 10px;
    font-size: 22px;
    float: left;
    padding-top: 5px;  
  }

</style>

<!-- Create a simple CodeMirror instance -->
<link rel="stylesheet" href="/js/codemirror.css">
<script src="/js/codemirror.js"></script>
<script src="/js/javascript.js"></script>
<script src="/js/jquery.twinkle-0.8.0.js"></script>


<script type="text/javascript">

$('document').ready(function(){
  
  var request = null, snippetLoading = false;
  
  function loadSnippet (src) {
    // don't stack ajax requests...just cancel the last one :-)
    if (snippetLoading) {
      request.abort();
    }
    snippetLoading = true;
    showCode();
    editor.setValue("loading...");
    loadingSnippet();
    request = $.get('http://hook.io' + src + '/source', function (res) {
      snippetLoaded();
      editor.setValue(res);
    });
  };
  
  $('.hookFrame').on("load", function() {
    snippetLoaded();
    $('.CodeMirror').hide();
    $('.hookFrame').show();
  });
  
  var deployingCode = false;
  
  function deployCode () {
    if (snippetLoading) {
      // do not attempt to deploy code if a new snippet is still loading...
      return false;
    }
    var now = new Date().getTime();
    $('#source').val(editor.getValue());
    $('.gatewayForm').submit();
    return false;
  };
  
  function saveToGithub () {
    $('.gistSource').val(editor.getValue()); // name="source"
    $('.saveForm').submit();
    return false;
  };
  
  $.fn.random = function() {
    return this.eq(Math.floor(Math.random() * this.length));
  }          

  $('.saveButton').on('click', function(){
    // post current code to be forked / saved in current session
    saveToGithub();
  });


  function loadingSnippet () {
    $('.CodeMirror').css('opacity', 0.4);
    $('.hookFrame').css('opacity', 0.4);
    $('.loadingImg').show();
  };

  function snippetLoaded () {
    snippetLoading = false;
    $('.loadingImg').hide();
    $('.CodeMirror').css('opacity', 1);
    $('.hookFrame').css('opacity', 1);
  };


  $('.runButton').on('click', function(){
    loadingSnippet();
    deployCode();
  });

  function showCode () {
    $('.CodeMirror').show();
    editor.setCursor(0,0);
    editor.focus();
    editor.refresh();
    $('.hookFrame').hide();
  };
  function showResult () {};

  $('.codeButton').on('click', function(){
    showCode();
  });


  var loadHeaderSection = function loadHeaderSection () {
    $(".splashSections > div").hide();
    //alert("." + $(this).attr('id'))
    $('.tagLines').show();
    $('.tagLines').removeClass('hidden');
  }
  
  $('#header img').click(loadHeaderSection)
  //$('#header img').hoverIntent(loadHeaderSection)
  
  var loadSplashSection = function loadSplashSection () {
    //$(".splashSections > div").hide();
    //alert("." + $(this).attr('id'))
    $(document).scrollTo($("." + $(this).attr('id')));
    $("." + $(this).attr('id')).removeClass('hidden');
  }

  //$('.splashImage img').hoverIntent(loadSplashSection);
  $('.splashImage img').click(loadSplashSection);
  
  function checkStats () {
    // TODO: add real-time info for other metrics
    $.get('/metrics/hook/totalHits', function(res){
      $('.totalRun').html(numberWithCommas(res.toString()));
      setTimeout(checkStats, 500);
    });
  };

  function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  checkStats();

  editor = CodeMirror.fromTextArea($('textarea').get(0), {
    lineNumbers: true
  });
  
    
  setTimeout(function(){
    var options = {
      effect: 'drops',
      effectOptions: {
        radius: 160,
        duration: 1500,
        width: 2,
        count: 3,
        delay: 100
      }
    };
    // $('.runButton').twinkle(options);
  }, 400);

  $('.selectSnippet').on('change', function(){
    // var item = $(this)
    loadSnippet($('.selectSnippet').val());
  });

  $('.nextSnippet').on('click', function() {
    $('.prevSnippet').show();
    var index = $('.selectSnippet').prop('selectedIndex');
    var next = index + 1;
    if (next === $('.selectSnippet option').length) {
      next = 0;
    }
    $('.selectSnippet').prop('selectedIndex', next).change();
    return false;
  });

  $('.prevSnippet').on('click', function(){
    var index = $('.selectSnippet').prop('selectedIndex');
    var prev = index - 1;
    if (prev === -1) {
      prev = $('.selectSnippet option').length - 1;
    }
    $('.selectSnippet').prop('selectedIndex', prev).change();
    return false;
  });
  // loadSnippet();

});
var editor;
</script>

<br/>


<div class="container-fluid">

  <div class="userBar">
    <span class="welcome"></span><br/>
    <a href="/new">Create Hook</a><br/>
    <a href="/Marak" class="yourHooks">My Hooks</a><br/>
    <a href="/datastore" class="yourDatastore">My Datastore</a><br/>
    <a href="/domains" class="yourDomains">Custom Domains</a><br/>
    <a href="/account" class="yourAccount">Account Information</a><br/>
    <a href="/billing" class="yourBilling">Billing Information</a><br/>
    <a href="/affiliates" class="yourAffiliates">Affiliates Program</a><br/>
    <a href="/logout">Logout</a>
  </div>

  <div class="row loginBar">
    <div class="col-md-12" align="center">
      <a href="/login" class="btn btn-social btn-github" style="padding: 14px 24px;font-size: 21px;"><i class="fa fa-github"></i><span style="padding-left:60px"> Sign in with Github</span></a>
    </div>
  </div>
  <br/>
  <div class="row loginBar">
    <div class="col-md-12" align="center">
      <p class="hookStats"><a href="#" class="deploymentsLink" title="Whenever a service URL is requested, hook.io will take a copy of the Hook's source code and deploy it to an awaiting worker in our elastic cloud to respond to the incoming request.">Deployments:</a> <span class="totalRun">loading...</span> </p>
      
    </div>
  </div>
  <!-- <h2>Try it now!</h2> -->
  
  <div class="row">
    <div class="col-md-8" align="left">
      <h2>Interactive Microservice Tutorial</h2>

      <div class="btn-group transport" role="group">
        <select name="selectSnippet" class="selectSnippet btn btn-default">
          <option value="/Marak/examples/helloWorld">hello world</option>
          <option value="/Marak/examples/simpleHttpRequest">send outgoing http requests</option>
          <option value="/Marak/examples/requestParameters">access incoming request data</option>
          <option value="/Marak/examples/inputSchema">add input schemas</option>
          <option value="/Marak/examples/transformStream">transform streaming requests</option>
          <option value="/Marak/examples/pipeHook">pipe streaming requests</option>
          <option value="/Marak/examples/mergeStreams">merge streams</option>
          <option value="/Marak/examples/datastore">use the cloud datastore</option>
          <option value="/Marak/examples/imageResize">resize images</option>
          <option value="/Marak/examples/fakeData">generate fake data</option>
          <!--
          <option value="/Marak/coin">get crypto-currency prices</option>
          <option value="/Marak/geoip">lookup requests geoip</option>
          -->
          <!-- <option value="/Marak/markdown">render markdown</option> -->
          <!-- <option value="/Marak/spellcheck">spellcheck words</option> -->
        </select>
        <div class="transportControl">&nbsp;
          <a class="prevSnippet" href="#prev"><span class="octicon octicon-playback-rewind"></span>
          Prev</a>
        </div>
        <div class="transportControl">
          <a class="nextSnippet" href="#next">
          Next&nbsp;<span class="octicon octicon-playback-fast-forward"></span></a>
        </div>
        <div class="transportControl">
          <!-- /gist endpoint is used for creating new gists from source code as string -->
            <input name="source" class="gistSource" type="hidden"/>
            <button class="runButton btn btn-primary">Deploy Service</button>
            <button class="codeButton btn btn-default">Edit Service</button>
          <form name="saveForm" id="saveForm" class="saveForm" action="/gist" method="POST">
            <button class="saveButton btn btn-default">Save Service to Github</button>
          </form>
        </div>
        <!--
          <div class="transportControl">
            <img src="/img/default.svg" class="loadingImg"/>
          </div>
        -->
      </div>
      <!-- http://gateway.hook.io endpoint is used for deploying arbitrary untrusted code ( as strings ) from anonymous sources -->
      <form name="gatewayForm" id="gatewayForm" action="http://gateway.hook.io" method="POST" target="hookFrame" class="gatewayForm">
      <textarea name="source" id="source">// A simple hello world microservice 
// Click "Deploy Service" to deploy this code
// Service will respond to HTTP requests with a string
module['exports'] = function helloWorld (hook) {
  // hook.req is a Node.js http.IncomingMessage
  var host = hook.req.host;
  // hook.res is a Node.js httpServer.ServerResponse
  // Respond to the request with a simple string
  hook.res.end(host + ' says, "Hello world!"');
};</textarea>
    </form>
      <iframe name="hookFrame" class="hookFrame" src=""></iframe>
      <!-- <div class="hookOutput"></div> -->
    </div>
    <div class="col-md-4" align="left">
      <div class="featuresDiv">
        <h2>Full Featured</h2>
        <ul class="features">
          <li><a href="http://hook.io/docs#data">JSON / Query String / Multipart</a></li>
          <li><a href="http://hook.io/docs#data">Binary Data / Streaming Data</a></li>
          <li><a href="http://hook.io/git">Git Deploy Code Updates</a></li>
          <li><a href="http://hook.io/datastore">Cloud Datastore</a></li>
          <li><a href="http://hook.io/logs">Logging</a></li>
          <li><a href="http://hook.io/docs#schema">Input Validators</a></li>
          <li><a href="http://hook.io/modules">NPM Modules</a></li>
          <li><a href="http://hook.io/cron">Cron Tasks</a></li>
          <!-- <li><a href="http://hook.io/docs#metrics">Metrics</a></li> -->
          <li><a href="http://hook.io/themes">Theming Engine</a></li>
          <li><a href="http://hook.io/docs#forms">Form Generator</a></li>
          <li><a href="https://hook.io/ssl">SSL / HTTPS</a></li>
          <li><a href="http://hook.io/docs#domains">Custom Domains</a></li>
          <li><a href="http://hook.io/curl">Unix Pipe Integration</a></li>
          <li><a href="http://github.com/bigcompany/hook.io">100% open-source</a></li>
        </ul>
      </div>
    </div>
  </div>
  <br/>

  <br/>

</div>

