<style>

#hookForm h1 {
  font-size: 42px;
  font-weight: 700;
}

#hookForm h2 {
  margin: 0px;
  padding: 0px;
  margin-bottom: 10px;
  font-size: 32px;
  font-weight: 700;
}

.smaller {
  font-size: 18px;
}

.cronRow .warning {
  font-size: 18px;
}

.warning {
  color: red;
}

.helpLang {
  display: none;
}

.cron-button {
    height: 16px;
    padding-left: 20px;
    margin-left: 5px;
    background-repeat: no-repeat; 
    background-position: center center; 
    cursor: pointer;
}
.cron-button-save {
    background-image: url('img/disk.png');
}
.cron-changed {
    padding-top: 5px;
    padding-bottom: 5px;
    background-color: #fdd;
}
.cron-controls {
    margin-left: 10px;
    color: #c77;
    font-size: 0.9em;
}
.cron-controls > span.cron-loading {
    background-image: url('img/loading.gif');
}

.languages {
  display: block;
}

/*
select {
  font-size: 32px;
  cursor: pointer;
}
*/

.routeHint {
  display: none;
}

.hookLinks {
  width: 100%;
  margin-top: 20px;
  background-color: white;
}
.hookLinks td {
  padding: 10px;
  margin: 10px;
}

.routeExamples {
  background-color: white;
  padding: 10px;
  margin: 10px;
  border: solid;
  border-width: 1px;
}
.routeExamples td {
  padding: 10px;
  margin: 10px;
}
.left {
  width: 220px;
}

code {
  padding: 0px;
  margin: 0px;
}

label {
  cursor: hand;
}
.hookFrame {
  display: none;
}
/*
.error {
  background-color: red;
}
*/
/* do not group these rules */
.error::-webkit-input-placeholder {
    color: white;
}
.error*:-moz-placeholder {
    /* FF 4-18 */
    color: white;
}
.error*::-moz-placeholder {
    /* FF 19+ */
    color: white;
}
.error*:-ms-input-placeholder {
    /* IE 10+ */
    color: white;
}

.securityHolder {
  background-color: #F5F5F5;
  border: 1px solid #E1E1E1;
  padding: 17px 17px 0px 17px;  
  padding-top: 10px;
  padding-bottom: 5px;
  padding-left: 20px;
  padding-right: 20px;
  width: 100%;
  margin-bottom: 20px;
}

.cronRow {
  display: none;
  background-color: #F5F5F5;
  border: 1px solid #E1E1E1;
  padding: 17px 17px 0px 17px;  
  padding-top: 10px;
  padding-top: 10px;
  padding-bottom: 20px;
  padding-left: 20px;
  padding-right: 20px;
  width: 100%;
  margin-bottom: 20px;
}

.cronRow .tabs {
  font-size:16px;
}
.cronRow #clear {
  font-size:16px;
}

input[type="text"] {
  width: 100%;
  margin-right: 10px;
  padding-right: 10px;
}

input[type="checkbox"] {
  cursor: pointer;
}

#create {
  margin-top: 10px;
}

.hookTable td {
  font-size: 22px;
  font-weight: bold;
}

.hookTable td input {
  font-size: 22px;
  font-weight: normal;
}

.hookTable td span {
  margin-top: 10px;
  font-size: 22px;
  font-weight: normal;
  margin-bottom: 10px;
}

.tiny {
  font-size: 16px;
}

.themeRow {
  display: none;
  background-color: #F5F5F5;
  border: 1px solid #E1E1E1;
  padding: 17px 17px 0px 17px;
  padding-top: 10px;
  padding-bottom: 20px;
  padding-left: 20px;
  width: 100%;
  margin-bottom: 20px;
}

.hookHolder {
  background-color: #F5F5F5;
  border: 1px solid #E1E1E1;
  padding: 17px 17px 0px 17px;  padding-top: 10px;
  padding-bottom: 5px;
  padding-left: 20px;
  padding-right: 20px;
  width: 100%;
  margin-bottom: 30px;
}

.hookHolder .form-control {
  margin-bottom: 10px;
}

.hookHolder .form-group {
  margin-bottom: 10px;
}
.gistUrlHolder {
  padding-top: 10px;
  width: 100%;
  display: none;
}

.sourcesHolder {
  background-color: #F5F5F5;
  border: 1px solid #E1E1E1;
  padding: 17px 17px 0px 17px;  
  padding-top: 10px;
  padding-bottom: 5px;
  padding-left: 20px;
  padding-right: 20px;
  width: 100%;
  margin-bottom: 20px;
}
.sources {
  margin-bottom: 0px;
}

.cronDiv {
  width: 100%;
}

.codeEditorHolder {
  margin-bottom: 20px;
  background-color: #f5f5f5;
}
body .CodeMirror {
  height: 280px;
  box-shadow: none;
  font-size: 14px;
}
.sourceHeader {
  max-width: 100%;
  margin-bottom: 5px;
  font-weight: 700;
}

body legend {
  border: none;
  padding: 0px;
  margin: 0px;
}

/*
.tiny .small-btn {
  font-size: 16px;
  margin-top: 10px;
  margin-bottom: 10px;
  width: 200px;
}
.tiny .small-btn:hover {
  font-weight: bold;
}
*/

.codeEditorHolder .btn {
  width: 120px;
}

.btn {
  margin-top: 10px;
  width: 200px;
}

.btn:hover {
  font-weight: bold;
}

.mediumLink {
  font-size: 22px;
  font-weight: normal;
  font-style: italic;
}


.hookFrame {
  background-color: white;
  margin-top: 10px;
  margin-bottom: 10px;
  font-family: monospace;
  height: 210px;
  color: black;
  border: solid;
  border-width: 1px;
  box-shadow: 10px 10px 5px #888888;
  display: none;
  padding: 10px;
  width: 100%;
}

.cronClear {
  margin-bottom: 10px;
}

.warnLanguages {
  display: none;
  margin-top: 10px;
  margin-bottom: 10px;
}

</style>
<link href="{{appUrl}}/css/jquery-ui.css" rel="stylesheet">


<script type="text/javascript">

  var boot = {{hook}};

  var agreedToWarning = false;

  // client-side slugify
  // the server-side slugify code is much more robust covering much utf
  function slugify(text) {
    return text.toString().toLowerCase()
      .replace(/\s+/g, '-');           // Replace spaces with -
//      .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
//      .replace(/\-\-+/g, '-');         // Replace multiple - with single -
  }


  $(document).ready(function(){

    var deployingCode = false, snippetLoading = false;

    $('.codeButton').on('click', function(){
      showCode();
      return false;
    });

    $('#editorSource').on('click', function(){
      $('.gistUrlHolder').hide();
      $('.codeEditorHolder').show();
      editor.refresh();
    });

    $('#gistSource').on('click', function(){
      $('.codeEditorHolder').hide();
      $('.gistUrlHolder').show();
    });


    $('#name').on('click', function(){
      $('#name').removeClass('error');
    });

    $('#hookForm').on('submit', function(){
      var name = $('#name').val();
      if (name.length === 0) {
        $('#name').addClass('error').focus();
        $('#name').attr('placeholder', 'name is required...')
        //alert('name required');
        return false;
      }
    });

    $('.routeTipsButton').on('click', function(){
      if ($('.routeHint').css('display') === "none") {
        $('.routeHint').show();
      } else {
        $('.routeHint').hide();
      }
      return false;
    });

    $('#name, #path').on('keyup', function(e){
      var v = $(this).val();
      var s = slugify($(this).val());
      if (v !== s) {
        $(this).addClass('error');
        $(this).val(s);
      } else {
        if(v.length !== 0) {
          $(this).removeClass('error');
        }
      }
      if (e.keyCode === 13) {
        // $('#hookForm').submit();
      }
    });

    var options = {
      effect: 'drops',
      effectOptions: {
        radius: 80,
        duration: 1500,
        width: 2,
        count: 3,
        delay: 100
      }
    };

    var p = $('#name').position();
    $('#name').focus();

    $('#language').change(function(e){

      /*
      if (!agreedToWarning) {
        $('.warnLanguages').show();
        $('#create').attr('disabled', 'DISABLED');
      }
      */

      var l = $('#language').val();
      $('.currentLanguage').html($( "#language option:selected" ).text());
      $('.currentLanguageShort').html($( "#language" ).val());
      if (l === "javascript") {
        // $('#gist').attr('value', 'https://gist.github.com/Marak/357645b8a17daeb17458');
        //$('.helpLang').hide();
      } else {
        // TODO: better default gist values for non-javascript langauges
        $('#gist').attr('value', '');
        //$('.helpLang').show();
      }

      $('#gatewayLang').attr('value', l);
      $('#gatewayForm').attr('action', '/gateway');

      // assume first file is source code
      // see: https://github.com/bigcompany/{{appName}}/issues/110
      var keys = Object.keys(boot.examples[l]);
      editor.setValue(boot.examples[l]['source']);
      $('#editorSource').click();
      //showCode();
      return false;
      //var val = themes[$(this).val()];
    });

    //$('.services').html(JSON.stringify(boot.examples));


  });


</script>


<!-- background-image: url('./img/node_turtle.png');background-repeat: none; -->
<div style="text-align:left;" class="container">
  <form id="hookForm" method="POST" action="/new" role="form" enctype="application/x-www-form-urlencoded">
    <legend><h1 class="i18n">Create New Service</h1></legend>

    <div class="gistStatus i18n">Hey there! We just created a new Gist on Github using your account: <a href=""  class="i18n">here</a><br/>
      <br/>
      The Gist will now be associated with the Hook service once you've completed this form.
    </div>

    <div class="hookHolder">
      <h2 class="i18n">Service Information</h2>
      <div class="form-group">
        <label for="name" class="i18n">Name</label>
        <input tabindex="1" class="form-control i18n" type="text" id="name" name="name" placeholder="name of hook..." size="40"/>
        <div class="tiny">
          <em class="hint">Will be part of the url to access the hook. Cannot contain non-url safe characters.</em>
        </div>
      </div>
      <div class="form-group">
        <label for="path" class="i18n">Route</label>
        <input tabindex="2" class="form-control i18n" type="text" id="path" name="path" placeholder="optional regex routing path..." size="40"/>
        <div class="tiny">
          <em class="hint">Optional Regular Expression route path for the service. Route parameters will merge with all query string and form parameters in the service handler's <code>Hook.params</code> scope. <a href="{{appUrl}}/docs#hook">Read More</a></em><br/>
          <button tabindex="3" type="button" class="routeTipsButton btn small-btn i18n">Route Formatting Help</button>
          
          <!--
          <div class="left button_set_plain button_margin">                  
            <div class="newsl_button">
              <button tabindex="3" type="button" class="routeTipsButton btn small-btn i18n"><span>Route Formatting Help</span></button>
            </div>
          </div>
          -->
        </div>

        <div class="tiny routeHint">
          <h4 class="i18n">Route Formatting</h4>
          <table class="routeExamples" border="1">
            <tr>
              <td><code>:name</code></td>
              <td class="i18n">a named parameter to capture from the route</td>
            </tr>
            <tr>
              <td><code>*splat</code></td>
              <td class="i18n">a wildcard splat to capture from the route</td>
            </tr>
            <tr>
              <td><code>()</code></td>
              <td class="i18n">Optional group that doesn't have to be part of the query. Can contain nested optional groups, params, and splats</td>
            </tr>
            <tr>
              <td><code>strings</code></td>
              <td class="i18n">Anything else. Interpolate static strings with params.</td>
            </tr>
          </table>

          <h4>Route Examples</h4>
          <div class="routeExamples">
            <code>
              /:id/create <br/>
              /some/(optional/):thing <br/>
              /users/:id/comments/:comment/rating/:rating <br/>
              /*a/foo/*b <br/>
              /books/*section/:title <br/>
            </code>
          </div>
        </div>

      </div>

      <div class="form-group private">
        <label for="hookPublic">Public Service</label>
        <input tabindex="5" type="radio" value="false" class="hookPublic" id="hookPublic" name="isPrivate" title="Specify the source of the Hook from text editor">
        &nbsp;
        <label for="hookPrivate">Private Service</label>
        <input tabindex="4" type="radio" value="true" class="hookPrivate" id="hookPrivate" name="isPrivate" title="Specify the source of the Hook as a Github Gist">
        <div class="paidAccount">In order to enable private services, you must upgrade to a <a href="{{appUrl}}/pricing">paid account</a>.<br/></div>
        <p>A public service will be publicly indexed and available for anyone to access at anytime. A private service will be hidden and only allowed accessible through a <a href="{{appUrl}}/keys" target="_blank">role based key access credential</a>.</p>
      </div>

    </div>

    <input tabindex="12" id="create" name="create" type="submit" value="Save and Continue"/ class="btn i18n">
  </form>

  <div class="codeEditor">

  <br/>

  <!--
  <h3>Not sure how to get started? Here is a basic echo example below.</h3>

  <form method="GET" action="/Marak/echo">
    <input tabindex="1" id="fork" name="fork" type="submit" value="Fork This Hook"/ class="btn">
  </form>

  <div data-gist="357645b8a17daeb17458">Loading...</div>
  -->
  <br/>
  <br/>
</div>
<script src="/js/jquery.croneditor.js" type="text/javascript"></script>
<script src="/js/jquery-ui.js"></script>
